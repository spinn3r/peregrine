#!/bin/sh

branch=$(hg branch)

if [ "$branch" != "default" ]; then
    exit 125
fi

cp build.xml build.xml.bak && cp build.xml.working build.xml && ant clean jar compile.test
result=$?

#skip if the build failed.
if [ "$result" != "0" ]; then

    result=125

else
    ant test
    result=$?
fi

hg revert build.xml

exit $result
